\section{XBee}
As discussed earlier the communication in the system will be done using xbee modules using the zigbee protocol. In this section it will be discussed how it were specifically implemented in this system, along with the impact this choice could have on the real-time system requirements.

\subsection{Sending Modes}
The xbee module have two different control interfaces transparent- and API-mode.
\subsubsection{Transparent Mode}
In transparent mode whatever the xbee module receives on its serial input pins it immediately sends over the network to the address specified in the firmware settings. This means the time to send data is insignificant. \ranote(Put the specifics of this result in an appendix?) A single message can be sent in under 2ms, however because there is no administration of the network spamming the network will increase the sent time to upwards of 60ms. Unless the client/host program handles it, there is no guarantee that each package is received. \cref{arduino_at_mode}
In this mode a lot of messages can be sent quickly but with little control.
%https://docs.digi.com/display/WirelessConnectivityKit/Command+mode
\subsubsection{API Mode}
In API mode the xbee module buffers the data it receives on its serial pins, to a limit of 64 bytes, until a specific command is received. If it receives a send command it packages the data in its buffer in the zigbee protocol\footnote(The zigbee protocol is IEEE 802.15.4 based), which includes the modules address, network info and also makes the receiving module sent back a received acknowledgement (except if broadcasting). This process creates overhead resulting in the send time (including receiving the acknowledgement) taking up to 60ms. However it is possible to ignore the acknowledgement, this means the send time is lowered significantly\ranote{lav testen eller træk et tal op af hatten? eller lad det stå som nu?}.
\subsection{Implementation}
While there should be no so significant single sensor state that the system takes a considerable precision hit if it gets lost, in our tests the send time also has not slowed down the system to a degree that makes it break the real-time requirement. The actions the server sends however needs to always reach its client, for this reason this system uses the API-mode.
\subsubsection{Aruino Implementation}
Using the official xbee for arduino library\cref{xbee_arduino_library} simple calls to the arduino is facilitated through the c++ objects given in the library. The way sending is handled is then that a send command is sent to the module, then waits a maximum of 250ms for a acknowledgement. If no acknowledgement were given the package is sent again but ignore the acknowledgement as holding the arduino loop for longer can significantly impact the system as a whole.
Receiving data is done using predefined call back methods from the library. A single method call ensures that every kind of package is processed, and the specific ones we need to do specific processing on can be overwritten. The package that the arduino needs to care about is the zbReceive, ie. the package that contains user defined data. On the arduino, in this version of the system, the only possible data this can contain is an action so this method decodes and performs the appropriate action.
%https://github.com/andrewrapp/xbee-arduino